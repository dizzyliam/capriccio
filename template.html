<html>

    <head>
        <title>Liam Scaife</title>
        <link rel="stylesheet" href="/style.css" />
        <link rel="stylesheet" href="/customStyle.css" />

        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/medium-editor@latest/dist/css/medium-editor.min.css" type="text/css" media="screen" charset="utf-8">
        <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/medium-editor@latest/dist/css/themes/beagle.css" type="text/css" media="screen" charset="utf-8">
    </head>

    <body>
        <script src="//cdn.jsdelivr.net/npm/medium-editor@latest/dist/js/medium-editor.min.js"></script>
        <script src="//code.jquery.com/jquery-3.5.1.js"></script>

        <img src="/icon.png" id="login-icon" onclick="promptPass()"/>
        <a hidden id="delete-icon" href="#" onclick="deleteFile()">Delete.</a>

        #CONTENT#
        <script>

            var pass = localStorage.getItem("pass");
            if (typeof(localStorage.getItem("pass")) != "undefined" && localStorage.getItem("pass") != null) {
                $.post("/api/login", data=pass).done(function( data ) {
                    if (data["success"]) {

                        var editor = new MediumEditor('#editable', {
                            toolbar: {
                                allowMultiParagraphSelection: true,
                                buttons: ['bold', 'italic', 'underline', 'anchor', 'h1', 'h2', 'h3', 'quote'],
                                diffLeft: 0,
                                diffTop: -10,
                                firstButtonClass: 'medium-editor-button-first',
                                lastButtonClass: 'medium-editor-button-last',
                                relativeContainer: null,
                                standardizeSelectionStart: false,
                                static: false,
                                /* options which only apply when static is true */
                                align: 'center',
                                sticky: false,
                                updateOnEmptySelection: false
                            }
                        });

                        $("#delete-icon").show()

                        editor.subscribe('editableInput', function (event, editable) {

                            var dataSend = {pass: pass, loc: location.pathname, body: $("#editable").html()};

                            $.ajax({
                                url: '/api/edit',
                                type: 'POST',
                                data: JSON.stringify(dataSend),
                                contentType: 'application/json; charset=utf-8',
                                dataType: 'json',
                                async: false,
                                success: function(data) {
                                    if (data["success"] == false) {
                                        alert("Edit failed; please try logging in again. Have a good day.");
                                    }
                                }
                            });
                        });

                    }
                });
            }

            function promptPass() {

                if (typeof(localStorage.getItem("pass")) != "undefined" && localStorage.getItem("pass") != null) {
                    localStorage.removeItem("pass");
                    location.reload(true);
                } else {

                    var pass = window.prompt("Gardener's Password","");
                    console.log(pass);
                    $.post("/api/login", data=pass).done(function( data ) {
                        if (data["success"]) {

                            localStorage.setItem("pass", pass);
                            location.reload(true);

                        }
                    });

                }
            }

            function deleteFile() {
                var pass = localStorage.getItem("pass");
                $.ajax({
                    url: '/api/delete',
                    type: 'POST',
                    data: JSON.stringify({pass: pass, loc: location.pathname}),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    async: false,
                    success: function(data) {
                        if (data["success"]) {
                            window.location.replace('/');
                        }
                    }
                });
            }

        </script>

    </body>

</html>